/*! leap-cursor-library 2013-07-24 */
LeapElement=function(a){this.element=a,this.cursor=null};LeapElement.prototype={isAttractor:function(){return"true"===this.element.getAttribute("leap-attractor")||null!=this.element.getAttribute("leap-attractor-x-padding")&&!isNaN(this.element.getAttribute("leap-attractor-x-padding"))||null!=this.element.getAttribute("leap-attractor-y-padding")&&!isNaN(this.element.getAttribute("leap-attractor-y-padding"))},appendChild:function(a){return a instanceof HTMLElement?this.element.appendChild(a):this.element.appendChild(a.getElement())},removeChild:function(a){return a instanceof HTMLElement?this.element.removeChild(a):this.element.removeChild(a.getElement())},getID:function(){return this.element.id},setStyle:function(a){for(var b in a)this.element.style[b]=a[b]},getParent:function(){return this.element.parentNode},getWidth:function(){return this.element.offsetWidth},getHeight:function(){return this.element.offsetHeight},getElement:function(){return this.element},hasCursor:function(){return null!==this.cursor},capture:function(a){this.cursor=a,this.cursor.capture(this)},release:function(){this.cursor&&(this.cursor.release(),this.cursor=null)},getAttractorPadding:function(){return{x:parseInt(this.element.getAttribute("leap-attractor-x-padding"),10)||0,y:parseInt(this.element.getAttribute("leap-attractor-y-padding"),10)||0}},setAttribute:function(a,b){this.element.setAttribute(a,b)},getClickDelay:function(){return this.element.getAttribute("leap-click-delay")},hasMultitap:function(){return"true"===this.element.getAttribute("leap-enable-multitap")},isTappable:function(){return"true"!==this.element.getAttribute("leap-disable-tap")},isHoverable:function(){return"true"!==this.element.getAttribute("leap-disable-hover")},hasRelay:function(){return null!==this.element.getAttribute("leap-relay")},getRelay:function(){var a=this.element.getAttribute("leap-relay");return a},setXY:function(a,b){this.setX(a),this.setY(b)},setX:function(a){this.element.style.left=a+"px"},setY:function(a){this.element.style.top=a+"px"},getX:function(){return this.element.getBoundingClientRect().left},getY:function(){return this.element.getBoundingClientRect().top},scroll:function(a){var b=this.element.clientHeight>this.element.parentElement.clientHeight,c=this.element.clientWidth>this.element.parentElement.clientWidth;this.element===document.body?b>0&&b>c?this.scrollY(a):c>0&&this.scrollX(a):this.element.scrollHeight>this.element.clientHeight?this.scrollY(a):this.element.scrollWidth>this.element.clientWidth&&this.scrollX(a)},scrollX:function(a){this.element.scrollLeft+=a},scrollY:function(a){this.element.scrollTop+=a},addClass:function(a){var b=this.element.className;b&&-1!==b.indexOf(a)||(""!==b&&(a=" "+a),this.element.className=b+a)},removeClass:function(a){var b=this.element.className,c=new RegExp("\\s?\\b"+a+"\\b","g");b=b.replace(c,""),this.element.className=b},fireEvent:function(a){this.element.dispatchEvent(a)}};var LeapManagerUtils=function(){var a={},b="leap_element_",c=0,d={};return{getLeapElement:function(d){return null==d?null:(d.id||(d.id=b+c++),a[d.id]||(a[d.id]=new LeapElement(d)),a[d.id])},isElementVisible:function(a){for(;a!==document.body.parentNode;){if("0"===LeapManagerUtils.getStyle(a,"opacity")||"none"===LeapManagerUtils.getStyle(a,"display")||"hidden"===LeapManagerUtils.getStyle(a,"visibility"))return!1;a=a.parentNode}return!0},getStyle:function(a,b){return window.getComputedStyle?document.defaultView.getComputedStyle(a)[b]:a.currentStyle?a.currentStyle[b]:void 0},extend:function(a,b){for(var c in b)a[c]=b[c]},extendIf:function(a,b){for(var c in b)b[c]instanceof Object&&b[c].constructor===Object?((void 0===a[c]||null===a[c])&&(a[c]={}),LeapManagerUtils.extendIf(a[c],b[c])):(void 0===a[c]||null===a[c])&&(a[c]=b[c])},exists:function(a){return void 0!==a&&null!==a},bind:function(a,b,c){return function(){c||(c=[]),c=Array.prototype.slice.call(arguments).concat(c),a.apply(b,c)}},map:function(a,b,c,d,e){return a===b?d:(a-b)*(e-d)/(c-b)+d},error:function(a){console.log(a)},testStructure:function(a,b){for(var c,d=0;d<b.length;d++)if(c=b[d],"string"==typeof c){if(!LeapManagerUtils.exists(a[c]))return!1;a=a[c]}return!0},createStructure:function(a,b){for(var c,d=!0,e=0;e<b.length;e++)c=b[e],"string"==typeof c&&(LeapManagerUtils.exists(a[c])||(a=a[c]={},d=!1));return d},distance:function(a,b){var c,d;return c=b.x-a.x,c*=c,d=b.y-a.y,d*=d,Math.sqrt(c+d)},getQueryAll:function(a,b){return LeapManagerUtils.exists(d[a])||(d[a]=document.querySelectorAll(b)),d[a]},getQuery:function(a,b){return LeapManagerUtils.exists(d[a])||(d[a]=document.querySelector(b)),d[a]}}}(),Cursor=function(a){var b="leap-timer-cursor";if(!a)return LeapManagerUtils.error("Cursor#constructor: You must specify a config object."),null;if(!a.source)return LeapManagerUtils.error("Cursor#constructor: You must specify a `source`."),null;if(!a.id)return LeapManagerUtils.error("Cursor#constructor: You must specify a `id`."),null;if(!a.icon)return LeapManagerUtils.error("Cursor#constructor: You must specify a `icon`."),null;if(LeapManagerUtils.extendIf(a,this.defaultConfig),this.source=a.source,this.id=a.id,this.type=a.type,this.icon=a.icon,this.easing=a.easing,this.clickDelay=a.clickDelay,this.multitapEnabled=a.multitapEnabled,this.virtualParent=a.virtualParent||null,this.virtualParent&&(this.type="virtual",this.setElement(this.virtualParent.getElement()),this.virtualParent.addVirtual(this)),this.virtualCursors=[],(0===this.clickDelay||isNaN(this.clickDelay))&&(this.clickDelay=null),this.onTapUpdate=LeapManagerUtils.bind(this._onTapUpdate,this),this.clickDelay&&this.icon.addClass(b),this.icon instanceof HTMLElement&&(this.icon=new LeapElement(this.icon)),a.position){this.update(a.position.x,a.position.y);var c=this.icon.getWidth()/2,d=this.icon.getHeight()/2;this.icon.setX(a.position.x*window.innerWidth+c),this.icon.setY(a.position.y*window.innerHeight+d)}};Cursor.prototype={x:0,y:0,z:0,X:0,Y:0,Z:0,vX:0,vY:0,vZ:0,enabled:!0,captureHost:null,attractor:null,element:null,isTimerRunning:!1,type:"real",startTime:null,animiationIntervalID:null,state:"up",currentClickDelay:0,defaultConfig:{multitapEnabled:!1,clickDelay:0,easing:.3},_tapCapable:!0,_startPoint:null,onAdded:function(){},onRemoved:function(){},setManager:function(a){this.manager=a},setEnabled:function(a){this.enabled=a},isEnabled:function(){return this.enabled},setElement:function(a){this.element=a},getElement:function(){return this.element},hasElement:function(){return null!==this.element},onElementOver:function(a){this.setElement(a),this.currentClickDelay=this.element.getClickDelay()||this.clickDelay,a.isHoverable()&&a.addClass("hover"),this._tapCapable&&this.manager.isHoverTapEnabled()&&this.currentClickDelay&&a.isTappable()&&this.startTimer()},onElementDown:function(a){a.addClass("leap-down"),this.icon.addClass("cursor-down"),this.state="down"},onElementMove:function(){},onElementUp:function(a){this.state="up",a.removeClass("leap-down"),this.icon.removeClass("cursor-down")},onElementOut:function(a){a.isHoverable()&&a.removeClass("hover"),this.manager.isHoverTapEnabled()&&this.currentClickDelay&&a.isTappable()&&this.stopTimer(),this.setElement(null)},isDown:function(){return"down"===this.state},disableTap:function(){this.element&&(this.element.isHoverable()&&this.element.removeClass("hover"),this.currentClickDelay&&this.element.isTappable()&&this.stopTimer()),this._tapCapable=!1},restartTap:function(){this._tapCapable=!0},setAttractor:function(a){this.attractor=a},hasAttractor:function(){return null!==this.attractor},capture:function(a){this.captureHost=a,this.setAttractor(null)},isCaptured:function(){return null!=this.captureHost},release:function(){this.captureHost=null},update:function(a,b,c){this.setPositionX(a),this.setPositionY(b),this.setPositionZ(c)},setPositionX:function(a){this.X=a-this.x,this.x=a},setPositionY:function(a){this.Y=a-this.y,this.y=a},setPositionZ:function(a){this.Z=a-this.z,this.z=a},getX:function(){return this.x},getY:function(){return this.y},getZ:function(){return this.z},setVelocityXYZ:function(a,b,c){this.setVelocityX(a),this.setVelocityY(b),this.setVelocityZ(c)},setVelocityX:function(a){this.vX=a},setVelocityY:function(a){this.vY=a},setVelocityZ:function(a){this.vZ=a},getVelocityX:function(){return this.vX},getVelocityY:function(){return this.vY},getVelocityZ:function(){return this.vZ},getEasing:function(){return this.easing},fireEvent:function(a){this.element&&this.element.fireEvent.apply(this.element,[a])},startTimer:function(){this.animiationIntervalID&&this.stopTimer(),this.startTime=new Date;var a=this;this.animiationIntervalID=setInterval(function(){a.onTapUpdate()},1e3/30),this.onTimerStart()},stopTimer:function(){clearInterval(this.animiationIntervalID),this.startTime=null,this.onTimerStop()},isVirtual:function(){return"virtual"===this.type},addVirtual:function(a){this.virtualCursors.push(a)},_onTapUpdate:function(){if(!this.startTime)return this.stopTimer(),void 0;var a=new Date,b=a-this.startTime;this.onTimerUpdate(b),b>=this.currentClickDelay&&(this.stopTimer(),this.onTimerComplete())},onTimerStart:function(){this.icon.setStyle({transitionDuration:this.currentClickDelay/1e3+"s"}),this.icon.addClass("active-timer")},onTimerStop:function(){this.icon.setStyle({transitionDuration:"0s"}),this.icon.removeClass("active-timer")},onTimerUpdate:function(){},onTimerComplete:function(){if(this.element)if(this.dispatchDown(),this.dispatchUp(),this.dispatchClick(),this.dispatchTap(),this.multitapEnabled||this.element.hasMultitap()){var a=this;setTimeout(function(){a.startTimer()},100)}else this.release();else this.release()},dispatchOver:function(a){if(a&&this.setElement(a),this.hasElement()){var b=document.createEvent("MouseEvent");b.initMouseEvent("mouseover",!0,!1,window,1,this.icon.getX(),this.icon.getY(),this.icon.getX(),this.icon.getY(),!1,!1,!1,!1,0,this.element),this.element.fireEvent(b),this.onElementOver(this.element)}},dispatchMove:function(a){if(a&&this.setElement(a),this.hasElement()){var b=document.createEvent("MouseEvent");b.initMouseEvent("mousemove",!0,!1,window,1,this.icon.getX(),this.icon.getY(),this.icon.getX(),this.icon.getY(),!1,!1,!1,!1,0,this.element),this.element.fireEvent(b),this.onElementMove(this.element),this.manager.isPressDownEnabled()&&this.element.isTappable()&&(!this.isDown()&&this.getZ()<this.manager.getPressThreshold()?this.dispatchDown(a):this.isDown()&&this.getZ()>this.manager.getPressThreshold()&&this.dispatchUp(a))}},dispatchOut:function(a){if(a&&this.setElement(a),this.hasElement()){var b=document.createEvent("MouseEvent");b.initMouseEvent("mouseout",!0,!1,window,1,this.icon.getX(),this.icon.getY(),this.icon.getX(),this.icon.getY(),!1,!1,!1,!1,0,this.element),this.element.fireEvent(b),this.onElementOut(this.element)}},dispatchDown:function(a){if(a&&this.setElement(a),this._startPoint={x:this.icon.getX(),y:this.icon.getY()},this.hasElement()){var b=document.createEvent("MouseEvent");b.initMouseEvent("mousedown",!0,!1,window,1,this.icon.getX(),this.icon.getY(),this.icon.getX(),this.icon.getY(),!1,!1,!1,!1,0,this.element),this.element.fireEvent(b),this.onElementDown(this.element)}},dispatchUp:function(a,b){if(LeapManagerUtils.exists(b)||(b=!0),a&&this.setElement(a),this.hasElement()){var c=document.createEvent("MouseEvent");c.initMouseEvent("mouseup",!0,!1,window,1,this.icon.getX(),this.icon.getY(),this.icon.getX(),this.icon.getY(),!1,!1,!1,!1,0,this.element),this.element.fireEvent(c),this.onElementUp(this.element);var d=LeapManagerUtils.distance(this._startPoint,{x:this.icon.getX(),y:this.icon.getY()});b&&d>0&&100>d&&(this.dispatchClick(),this.dispatchTap())}},dispatchClick:function(a){if(a&&this.setElement(a),this.hasElement()){var b=document.createEvent("MouseEvent");b.initMouseEvent("click",!0,!1,window,1,this.icon.getX(),this.icon.getY(),this.icon.getX(),this.icon.getY(),!1,!1,!1,!1,0,this.element),this.element.fireEvent(b)}},dispatchTap:function(a){if(a&&this.setElement(a),this.hasElement()){var b=document.createEvent("UIEvent");b.initUIEvent("tap",!0,!1,window,1,this.icon.getX(),this.icon.getY(),this.icon.getX(),this.icon.getY(),!1,!1,!1,!1,0,this.element),this.element.fireEvent(b)}}};var CursorManager=function(a){if(this.globalInteractiveSelector=".leap-interactive",this.cursorContainerClass="leap-cursor-container",this.leapCursorClass="leap-cursor",this.interactiveSelector=a.interactiveSelector||null,this.untappableSelector=a.untappableSelector||null,this.pressThreshold=a.pressThreshold||0,this.enableHoverTap=a.enableHoverTap===!0,this.enablePressDown=a.enablePressDown===!0,this.greedySelector=a.greedySelector||null,!this.cursorContainer){this.cursorContainer=new LeapElement(document.createElement("div"));var b=a.root||document.body;b.appendChild(this.cursorContainer.element),this.cursorContainer.addClass(this.cursorContainerClass),this.cursorContainer.setStyle({zIndex:1e5,position:"fixed",top:"0px",left:"0px"})}};CursorManager.prototype={cursorContainer:null,elementLookup:{},mouseEvent:null,interactiveSelector:"",cursorLookup:{},isHoverTapEnabled:function(){return this.enableHoverTap===!0},isPressDownEnabled:function(){return this.enablePressDown===!0},getPressThreshold:function(){return this.pressThreshold||0},get:function(a,b,c){return null==c&&(c="real"),LeapManagerUtils.createStructure(this.cursorLookup,[c,a]),this.cursorLookup[c][a][b]},add:function(a){var b=a.type||"real",c=a.source||"default",d=a.id||0;return LeapManagerUtils.createStructure(this.cursorLookup,[b,c]),LeapManagerUtils.exists(this.cursorLookup[b][c][d])?this.cursorLookup[b][c][d]:(this.cursorLookup[b][c][d]=a,this.cursorContainer.appendChild(a.icon),a.icon.addClass(this.leapCursorClass),a.setManager(this),a.onAdded(),a)},remove:function(a){var b=a.type||"real",c=a.source||"default";if(a.id||0,!a.isVirtual()&&LeapManagerUtils.testStructure(this.elementLookup,[a.source,a.id])){var d=this.elementLookup[a.source][a.id];d&&d.isAttractor()&&(a.setAttractor(null),d.hasCursor()&&d.release()),d&&this.cursorOut(a,d,{x:a.icon.getX(),y:a.icon.getY()}),this.elementLookup[a.source][a.id]=null}for(var e,f=0;f<a.virtualCursors.length;f++)e=a.virtualCursors[f],this.removeVirtualCursor(e);return a.virtualCursors=[],a.setManager(null),a.onRemoved(),LeapManagerUtils.exists(a.icon.getParent())&&this.cursorContainer.removeChild(a.icon),LeapManagerUtils.testStructure(this.cursorLookup,[b,c])&&(this.cursorLookup[b][c][a.id]=null,delete this.cursorLookup[b][c][a.id]),!0},pruneCursors:function(a,b,c){if(LeapManagerUtils.exists(c)||(c="real"),LeapManagerUtils.testStructure(this.cursorLookup,[c,a])){var d,e,f=[];for(e in this.cursorLookup[c][a])d=this.cursorLookup[c][a][e],d instanceof Cursor&&-1===b.indexOf(d.id)&&f.push(d);for(var g=0;g<f.length;g++)this.remove(f[g])}},update:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=.1,q=1;for(m in this.cursorLookup)for(n in this.cursorLookup[m])for(o in this.cursorLookup[m][n])if(l=this.cursorLookup[m][n][o],l instanceof Cursor){if(l.isVirtual()){l.icon.setX(l.icon.getX()+l.getVelocityX()),l.icon.setY(l.icon.getY()+l.getVelocityY());continue}if(this.elementLookup[l.source]||(this.elementLookup[l.source]={}),this.elementLookup[l.source][l.id]||(this.elementLookup[l.source][l.id]=null),a={x:Math.round(l.getX()*window.innerWidth),y:Math.round(l.getY()*window.innerHeight)},k=this.elementLookup[l.source][l.id],!l.isEnabled()){k&&(k.isAttractor()&&(l.setAttractor(null),k.hasCursor()&&k.release()),this.cursorOut(l,k),this.elementLookup[l.source][l.id]=null);continue}g=l.icon.getWidth()/2,h=l.icon.getHeight()/2,l.isCaptured()||(l.attractor?(i=l.attractor.element.getBoundingClientRect(),b={x:Math.round(i.left+i.width/2-g),y:Math.round(i.top+i.height/2-h)},c=b.x-l.icon.getX(),d=b.y-l.icon.getY(),e=Math.abs(c/(i.width/2)),f=Math.abs(d/(i.height/2)),e>1&&(e=1),f>1&&(f=1),e=Math.abs(1-e),f=Math.abs(1-f),l.setVelocityXYZ(c*Math.max(p,Math.min(q,e)),d*Math.max(p,Math.min(q,f)),0),Math.abs(l.getVelocityX())<=.1&&Math.abs(l.getVelocityY())<=.1&&(l.setVelocityXYZ(0,0,0),l.icon.setX(b.x),l.icon.setY(b.y),l.attractor.capture(l))):(c=a.x-g-l.icon.getX(),d=a.y-h-l.icon.getY(),l.setVelocityXYZ(c*l.getEasing(),d*l.getEasing()))),l.icon.setX(l.icon.getX()+l.getVelocityX()),l.icon.setY(l.icon.getY()+l.getVelocityY()),k=this.getCollidingElements(a),j=this.elementLookup[l.source][l.id],k&&(null==j&&(this.elementLookup[l.source][l.id]=k,k.isAttractor()&&!k.hasCursor()&&null==l.attractor&&null==l.captureHost&&l.setAttractor(k),this.cursorOver(l,k)),this.cursorMove(l,k)),j&&j!==k&&(j.isAttractor()&&(l.setAttractor(null),j.hasCursor()&&j.release(l)),this.cursorOut(l,j),this.elementLookup[l.source][l.id]=k,k&&(this.cursorOver(l,k),k.isAttractor()&&null==l.attractor&&null==l.captureHost&&(k.hasCursor()||l.setAttractor(k))))}},cursorOver:function(a,b){a.dispatchOver(b)},cursorMove:function(a,b){a.dispatchMove(b)},cursorOut:function(a,b){a.dispatchOut(b)},cursorDown:function(a,b){a.dispatchDown(b)},cursorUp:function(a,b){a.dispatchUp(b)},getCollidingElements:function(a){var b=this.globalInteractiveSelector;"string"==typeof this.interactiveSelector&&this.interactiveSelector.length>0&&(b+=", "+this.interactiveSelector);var c,d,e,f,g,h,i,j=LeapManagerUtils.getQueryAll("interactiveElements",b)||[];for(e=j.length-1;e>=0;e--)if(f=j[e],LeapManagerUtils.isElementVisible(f)&&(g=f.getBoundingClientRect(),f=LeapManagerUtils.getLeapElement(f),f&&(c=f.isAttractor()?f.getAttractorPadding().x:0,d=f.isAttractor()?f.getAttractorPadding().y:0,h=a.x>g.left-c&&a.x<g.left+g.width+c,i=a.y>g.top-d&&a.y<g.top+g.height+d,h&&i&&(f.hasRelay()&&(f=LeapManagerUtils.getLeapElement(LeapManagerUtils.getQuery(f.getID()+"-relay",f.getRelay()))),f)))){if(f.isTappable()&&"string"==typeof this.untappableSelector&&this.untappableSelector.length>0){var k=LeapManagerUtils.getQueryAll("untappableElements",this.untappableSelector)||[];for(e=0;e<k.length;e++)if(k[e]===f.getElement()){f.setAttribute("leap-disable-tap","true");break}}return f}return null!==this.greedySelector?(f=LeapManagerUtils.getLeapElement(LeapManagerUtils.getQuery("greedySelector",this.greedySelector)),f.hasRelay()&&(f=LeapManagerUtils.getLeapElement(LeapManagerUtils.getQuery(f.getID()+"-relay",f.getRelay()))),f):null},getVirtualCursor:function(a,b){return this.get(a,b,"virtual")},addVirtualCursor:function(a){return this.add(a)},removeVirtualCursor:function(a){return this.remove(a)}};var MouseSimulator=function(){var a="leap-mouse-cursor";return{cursorManager:null,mouseCursor:null,init:function(b,c){this.cursorManager=b;var d=new LeapElement(document.createElement("div"));d.addClass(a);var e={source:"mouse",id:1,icon:d};LeapManagerUtils.extendIf(e,c),this.mouseCursor=new Cursor(e),this.enable()},enable:function(){this._onMouseMove=LeapManagerUtils.bind(this.onMouseMove,this),this._onMouseClick=LeapManagerUtils.bind(this.onMouseClick,this),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("click",this._onMouseClick),this.cursorManager.add(this.mouseCursor)},disable:function(){this.mouseCursor&&(document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("click",this._onMouseClick),this.cursorManager.remove(this.mouseCursor),this.mouseCursor=null)},update:function(a,b,c){this.mouseCursor.update(a,b,c)},onMouseMove:function(a){a=a||window.e;var b=0,c=0,d=0;a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scollTop+document.documentElement.scrollTop),b/=window.innerWidth,c/=window.innerHeight,d=this.currentZ,this.update(b,c,d)},onMouseClick:function(){}}}(),DualSwipe=function(a,b,c){this.firstGesture=a,this.secondGesture=b,this.direction=c,this.type="dual-swipe",this.state="stop"},LeapManager=function(){"use strict";var a="leap-pointable-cursor",b="leap-pointable-virtual-cursor",c="leap-pointable-virtual-scroller-cursor",d="leap",e={maxCursors:1,enableTouchScrolling:!1,enableScrollbarScrolling:!0,enableHoverTap:!0,enablePressDown:!1,pressThreshold:0,simulateWithMouse:!1,enableInBackground:!1,cacheQueries:!0,enableMetaGestures:!0,enableDefaultMetaGestureActions:!0,metaGestureMaxDelay:1200,greedySelector:null,root:null,gestureCallback:null,gestureScope:null,interactiveSelector:null,enableSenchaTouch:!1,boundary:{top:350,left:-100,right:100,bottom:150},touchScrollingConfig:{scrollVector:{x:0,y:1,z:0},scrollMaxSpeed:7,scrollMinSpeed:2,scrollMaxDuration:6},scrollbarScrollingConfig:{resetDelay:1e3,scrollMaxSpeed:7,scrollMinSpeed:2,scrollMaxDuration:6},cursorConfig:{multitapEnabled:!1,clickDelay:1e3},mouseCursorConfig:{multitapEnabled:!1,clickDelay:1e3},loopConfig:{enableGestures:!0}};return{cursorManager:null,gestureHistory:{},init:function(a){LeapManagerUtils.extendIf(a,e),this.boundary=a.boundary,this.maxCursors=a.maxCursors,this.simulateWithMouse=a.simulateWithMouse,this.gestureCallback=a.gestureCallback,this.gestureScope=a.gestureScope,this.cursorConfig=a.cursorConfig,this.enableTouchScrolling=a.enableTouchScrolling,this.touchScrollingConfig=a.touchScrollingConfig,this.enableScrollbarScrolling=a.enableScrollbarScrolling,this.scrollbarScrollingConfig=a.scrollbarScrollingConfig,this.enableMetaGestures=a.enableMetaGestures,this.enableDefaultMetaGestureActions=a.enableDefaultMetaGestureActions,this.metaGestureMaxDelay=a.metaGestureMaxDelay||500,a.enableSenchaTouch&&(null==a.interactiveSelector?a.interactiveSelector="":a.interactiveSelector+=",",a.interactiveSelector+=["a",".x-tab",".x-button",".x-video-ghost",".x-scroll-scroller",".x-list-item"].join(","),a.untappableSelector=[".x-scroll-scroller"].join(", ")),this.cursorManager=new CursorManager({root:a.root,interactiveSelector:a.interactiveSelector,untappableSelector:a.untappableSelector,enableHoverTap:a.enableHoverTap,enablePressDown:a.enablePressDown,pressThreshold:a.pressThreshold,greedySelector:a.greedySelector}),this.simulateWithMouse&&MouseSimulator.init(this.cursorManager,a.mouseCursorConfig||{});var b=this;b.isActiveWindow=!0,a.enableInBackground||(window.addEventListener("blur",function(){b.isActiveWindow=!1}),window.addEventListener("focus",function(){b.isActiveWindow=!0}));var c=function(a){b.onLoop(a)};null!==Leap&&Leap.loop(a.loopConfig,c)},onLoop:function(a){this.isActiveWindow&&(this.cursorManager.update(),this.updatePointables(a),this.updateGestures(a))},updatePointables:function(a){var b,c,e,f,g,h,i=[];if(a&&a.pointables)for(c=0;c<a.pointables.length&&c<this.maxCursors;c++)b=a.pointables[c],b&&(f=LeapManagerUtils.map(b.tipPosition[0],this.boundary.left,this.boundary.right,0,1),g=LeapManagerUtils.map(b.tipPosition[1],this.boundary.bottom,this.boundary.top,1,0),h=b.tipPosition[2],e=this.getCursor(b.id,{x:f,y:g,z:h}),i.push(e.id),e.update(f,g,h));this.cursorManager.pruneCursors(d,i)},getCursor:function(b,c){var e=this.cursorManager.get(d,b);if(e)return e;var f=new LeapElement(document.createElement("div"));f.addClass(a);var g={source:d,id:b,position:c,icon:f};return LeapManagerUtils.extend(g,this.cursorConfig),e=new Cursor(g),this.cursorManager.add(e),e},updateGestures:function(e){var f,g=this;e.gestures.length>0&&e.gestures.forEach(function(e){if(e.pointableIds&&e.pointableIds.length>0&&e.pointableIds.forEach(function(h){if(f=g.cursorManager.get(d,h),f instanceof Cursor){if(f.hasElement()){var i=document.createEvent("Event");i.initEvent("leap-"+e.type,!0,!0),i.state=e.state,i.gesture=e,f.element.fireEvent(i),i=document.createEvent("Event"),i.initEvent("leap-"+e.type+"-"+e.state,!0,!0),i.state=e.state,i.gesture=e,f.element.fireEvent(i)}if(g.gestureCallback&&g.gestureCallback.call(g.gestureScope||g,e),(g.enableTouchScrolling||g.enableScrollbarScrolling)&&"circle"===e.type){var j,k={x:LeapManagerUtils.map(e.center[0],g.boundary.left,g.boundary.right,0,1),y:LeapManagerUtils.map(e.center[1],g.boundary.bottom,g.boundary.top,1,0),z:0},l="leap-scroller",m=g.cursorManager.getVirtualCursor(l,e.id);if(g.enableTouchScrolling)if("start"===e.state){f.disableTap(),m&&g.removeVirtualCursor(m);var n=new LeapElement(document.createElement("div"));n.addClass(a),n.addClass(b),n.addClass(c);var o={source:l,id:e.id,position:k,icon:n};o.virtualParent=f,m=new Cursor(o),m.onAdded=function(){this.dispatchDown()},m.onRemoved=function(){this.setVelocityXYZ(0,0,0),this.dispatchUp()},g.cursorManager.addVirtualCursor(m)}else"stop"===e.state&&m?(f.restartTap(),g.cursorManager.removeVirtualCursor(m)):m&&(j=LeapManagerUtils.map(e.duration/1e6,0,g.touchScrollingConfig.scrollMaxDuration,g.touchScrollingConfig.scrollMinSpeed,g.touchScrollingConfig.scrollMaxSpeed),e.normal[2]>0?m.setVelocityXYZ(j*g.touchScrollingConfig.scrollVector.x,j*g.touchScrollingConfig.scrollVector.y,j*g.touchScrollingConfig.scrollVector.z):m.setVelocityXYZ(j*-g.touchScrollingConfig.scrollVector.x,j*-g.touchScrollingConfig.scrollVector.y,j*-g.touchScrollingConfig.scrollVector.z),m.dispatchMove());else if(g.enableScrollbarScrolling)if("start"===e.state){if(LeapManagerUtils.exists(f._lastElementTime)){var p=new Date-f._lastElementTime;p>g.scrollbarScrollingConfig.resetDelay&&(f._scrollElement=f.getElement())}f._lastElementTime=new Date,f.getElement()&&!LeapManagerUtils.exists(f._scrollElement)&&(f._scrollElement=f.getElement()),LeapManagerUtils.exists(f._scrollElement)&&f.disableTap()}else"update"===e.state?LeapManagerUtils.exists(f._scrollElement)&&(f._lastElementTime=new Date,j=LeapManagerUtils.map(e.duration/1e6,0,g.scrollbarScrollingConfig.scrollMaxDuration,g.scrollbarScrollingConfig.scrollMinSpeed,g.scrollbarScrollingConfig.scrollMaxSpeed),e.normal[2]>0?f._scrollElement.scroll(-j):f._scrollElement.scroll(j)):"end"===e.state&&f.restartTap()}}}),g.enableMetaGestures&&"stop"===e.state&&"swipe"===e.type){g.gestureHistory[e.type]instanceof Array||(g.gestureHistory[e.type]=[]),e.timestamp=(new Date).getTime();var h,i,j=0,k=0,l=0,m=!0;for(h=0;(m?2:3)>h;h++)Math.abs(e.direction[h])>j&&(j=Math.abs(e.direction[h]),k=h);if(e._direction=0===k?e.direction[0]>0?"right":"left":1===k?e.direction[1]>0?"up":"down":e.direction[2]>0?"backward":"forward",g.gestureHistory[e.type].push(e),2===g.gestureHistory[e.type].length&&(i=g.gestureHistory[e.type][0],e._direction===i._direction&&(l=e.timestamp-i.timestamp,console.log(l),l<g.metaGestureMaxDelay))){var n=new DualSwipe(e,i,e._direction);g.gestureCallback&&g.gestureCallback.call(g.gestureScope||g,n);var o=document.createEvent("Event");if(o.initEvent("leap-"+n.type,!0,!0),o.state=e.state,o.gesture=n,document.body.dispatchEvent(o),g.enableDefaultMetaGestureActions)switch(n.direction){case"left":history.back();break;case"right":history.forward();break;case"up":break;case"down":}}for(;g.gestureHistory[e.type].length>1;)g.gestureHistory[e.type].shift()}})}}}();